import pytest
import quickOpen
import os
from xml import etree

TEST_FILE_DIR = 'test\\testFiles'


def test_no_exceptions():
    for file in os.listdir(TEST_FILE_DIR):
        quickOpen.qopen(TEST_FILE_DIR + '\\' + file)


def test_plaintext():
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't') == 'example text' # qopen assumes text file
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't.txt') == 'example text'
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't.nonexistantfiletype') == 'example text' # defaults to read text
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't.lnk') == 'example text' # type w/ no opening code defaults to text


def test_json():
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't.json') == {"test":15}  # qopen assumes text file


def test_xml():
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't.xml').findtext('hey') == 'yo'


def test_accent():
    # large files should use chardet to detect encoding
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't_accent_large.txt') == "El hardware inalámbrico no autorizado " \
            "se puede introducir fácilmente. Los puntos de " \
            "acceso inalámbricos son relativamente poco costosos y se implementan fácilmente. Un " \
            "equipo de asesores bienintencionado que trabaja en una sala de conferencias podría"
    # small files should default to unicode
    assert quickOpen.qopen(TEST_FILE_DIR + '\\' + 't_accent_small.txt') == 'á'


def test_website():
    print(quickOpen.qopen('http://www.omdbapi.com/?t=Game%20of%20Thrones&Season=1&Episode=1'))


def test_iswebsite():
    assert quickOpen.is_website('localhost') is True
    assert quickOpen.is_website('52.53.152.107') is True  #ipv4
    assert quickOpen.is_website('2001:db8::') is True  #ipv6
    assert quickOpen.is_website('http://google.com') is True
    assert quickOpen.is_website('aefafeafeaf') is False
